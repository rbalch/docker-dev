# Story 1.1: Initialize a new Greenfield project with default settings

## Status

Approved

## Story

**As a** developer,
**I want** to run a single command to scaffold a new, empty AI development environment,
**so that** I can immediately start working on a new project.

## Acceptance Criteria

1. Running the CLI with no arguments and accepting all defaults successfully creates a `./ai-dev-environment` directory.
2. The created directory contains the `dev/` folder, a `docker-compose.yaml`, and a `Makefile`.
3. The `docker-compose.yaml` file defines the `dev` service and does **not** define an `app` service.
4. The `Makefile` contains the standard set of commands.
5. The command `npx bmad-method install` is successfully executed at the end of the process.
6. If a directory named `./ai-dev-environment` already exists, the tool should create `./ai-dev-environment-1` instead. If that also exists, it should try `./ai-dev-environment-2`, and so on.

## Tasks / Subtasks

- [ ] **Task 1 (AC: 1, 2):** Create the main CLI entry point at `src/index.ts` that orchestrates the scaffolding process.
    - [ ] Subtask 1.1: Implement the main function that calls the prompter, generator, and installer modules in sequence.
    - [ ] Subtask 1.2: Implement basic error handling using the strategy defined in `docs/architecture/18-error-handling-strategy.md`.

- [ ] **Task 2 (AC: 1, 2, 6):** Implement the interactive prompts and configuration logic in `src/prompts.ts` and `src/config.ts`.
    - [ ] Subtask 2.1: Create a prompt for the installation directory with the default set to `./ai-dev-environment`.
    - [ ] Subtask 2.2: Before creating the directory, implement logic to check if the target path exists.
    - [ ] Subtask 2.3: If the path exists, append a numeric suffix (`-1`, `-2`, etc.) until a unique path is found.
    - [ ] Subtask 2.4: Create a prompt for the project type (Greenfield/Brownfield).
    - [ ] Subtask 2.5: For this story, the logic should handle the "Greenfield" path when all prompts are answered with default values.

- [ ] **Task 3 (AC: 2, 3, 4):** Implement the file generator logic in `src/generator.ts`.
    - [ ] Subtask 3.1: Create a function that copies the contents of the `template/dev` directory to the new project's `dev` directory.
    - [ ] Subtask 3.2: Create a function that copies `template/Makefile.template` to `Makefile`.
    - [ ] Subtask 3.3: Create a function that processes `template/docker-compose.template.yaml`.
    - [ ] Subtask 3.4: The Docker Compose generator must **omit** the `app` service when the `projectType` is `greenfield`. [Source: `docs/architecture/6-components-revised.md`]

- [ ] **Task 4 (AC: 5):** Implement the installer logic in `src/installer.ts`.
    - [ ] Subtask 4.1: Create a function that uses Node's `child_process` to execute `npx bmad-method install` in the newly created project directory.
    - [ ] Subtask 4.2: The output of the command should be streamed to the user's console.

- [ ] **Task 5 (AC: 1, 2, 3, 4, 6):** Write tests for the CLI tool.
    - [ ] Subtask 5.1: Write unit tests for the `generator.ts` module to ensure the `docker-compose.yaml` is created correctly for the greenfield scenario. [Source: `docs/architecture/16-testing-strategy.md`]
    - [ ] Subtask 5.2: Write a unit test for the directory-exists logic to ensure it generates correct names (e.g., `ai-dev-environment-1`).
    - [ ] Subtask 5.3: Write an end-to-end `bats-core` test (`tests/e2e/greenfield.bats`) that runs the CLI with default inputs and verifies that the correct directory structure and files are created. [Source: `docs/architecture/16-testing-strategy.md`]

## Dev Notes

This story is the primary "happy path" for a greenfield project. The developer agent must adhere to the architecture and coding standards defined in the architecture documents.

- **Tech Stack:** The CLI must be written in TypeScript and run on Node.js. All dependencies should be managed via `package.json`. [Source: `docs/architecture/3-tech-stack.md`]
- **Project Structure:** The generated project structure must match the one defined in the architecture. The source code for the CLI itself must follow the structure laid out in `docs/architecture/10-frontend-architecture-cli.md`.
- **CLI Logic:** The core logic should follow the unidirectional flow described in the architecture: `prompts` -> `config` -> `generator` / `installer`. [Source: `docs/architecture/10-frontend-architecture-cli.md`]
- **No `app` container:** For this greenfield story, the `docker-compose.yaml` must only contain the `dev` service. The `app` service is only for brownfield projects. [Source: `docs/architecture/6-components-revised.md`]

### Testing

- All code must be tested according to the `Testing Strategy` document. [Source: `docs/architecture/16-testing-strategy.md`]
- Unit tests for logic should be placed in `tests/unit/`.
- The end-to-end test that validates the final output should be placed in `tests/e2e/`.
- The testing frameworks are Jest for unit tests and bats-core for E2E tests.

## Change Log

| Date       | Version | Description                | Author |
| :--------- | :------ | :------------------------- | :--- |
| 2025-08-28 | 1.0     | Initial draft              | Bob (SM) |
| 2025-08-28 | 1.1     | Updated default name and added dir check logic | Bob (SM) |

## Dev Agent Record

*(This section is to be filled out by the Dev Agent during implementation.)*

### Agent Model Used


### Debug Log References


### Completion Notes List


### File List


## QA Results

*(This section is to be filled out by the QA Agent during review.)*
