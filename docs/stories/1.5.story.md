# Story 1.5: Feedback Cleanup

**Status:** Ready for Development

**Story**
**As a** developer,
**I want** to address feedback and cleanup tasks after initial tool usage,
**so that** the developer experience is improved and the tool is more robust.

**Acceptance Criteria**
1.  A Node.js file system library (e.g., `fs-extra`) is used to copy brownfield project files into the `app/` directory.
2.  When a brownfield project is detected, the user is asked if they are using Vercel.
3.  If Vercel is being used, the Vercel-specific Dockerfile and entrypoint are copied to the `app/` directory, and it's confirmed that no Dockerfile previously existed.
4.  The proxy is correctly configured in `docker-compose.yaml`.
5.  Post-installation notes are clearer and provide more detail.
6.  An empty `.env` file is created.
7.  The `.bmad-flattenignore` file is copied from the templates.

**Tasks / Subtasks**
- [ ] Implement file copying for brownfield projects using `fs-extra` (or similar Node.js library).
- [ ] When brownfield, ask if Vercel is being used.
  - [ ] Implement a `--vercel` flag to bypass the interactive prompt for automated testing.
  - [ ] If yes (or if `--vercel` is used):
    - [ ] Make sure Dockerfile doesn't exist in destination folder.
    - [ ] Copy `templates/vercel/Dockerfile` into `app/` if not already present.
    - [ ] Copy `templates/vercel/docker-entrypoint.sh` into `app/`.
    - [ ] Copy `template/dev/vercel/docker-compose.vercel.template.yaml` to the project root as `docker-compose.vercel.yaml`.
    - [ ] Update `Makefile` to dynamically use `docker-compose.vercel.yaml` if it exists.
- [ ] Modify the bmad-flattener execution to run on the project root directory instead of config.appPath.
- [ ] Improve post-installation notes:
  - [ ] What was done.
  - [ ] What was generated and where.
  - [ ] Next steps.
  - [ ] How proxy works (if Vercel, explaining the override file and `Makefile` logic).
- [ ] Touch `.env`.
- [ ] Copy over `templates/.bmad-flattenignore`.

**Dev Notes**
- This story is part of **Epic 1: Foundational Scaffolding & Interactive Setup**.

**Testing**
- **Manual E2E Testing:** The primary validation for this story will be a full, manual end-to-end run of the tool, using the interactive prompts.
- **Automated Testing:** Automated tests MUST use the `--vercel` flag to test the Vercel-specific logic.
- **Test Scenarios:**
  1.  **Vercel Configuration Flow (Automated):**
      - **Scenario:** Run the tool in a brownfield project with the `--vercel` flag.
      - **Expected Result:**
        - The `docker-compose.vercel.yaml` file is created in the project root.
        - The `templates/vercel/Dockerfile` and `docker-entrypoint.sh` are copied to `app/`.
        - Run `make up`. The containers should start.
        - Run `make verify-proxy`. The command should return an HTTP status code of 200.
  2.  **Non-Vercel Configuration Flow:**
      - **Scenario:** Run the tool in a brownfield project without the `--vercel` flag and answer "No" when prompted.
      - **Expected Result:**
        - The `docker-compose.vercel.yaml` file should **not** be present in the project root.
        - Run `make up`. The dev container should start without exposing port 3000.
  3.  **Dockerfile Conflict:**
      - **Scenario:** Create a dummy `Dockerfile` in the `app/` directory of a brownfield project. Run the tool with `--vercel`.
      - **Expected Result:** The script should detect the existing Dockerfile and halt with an error, preventing an overwrite.
  4.  **File Generation:**
      - **Scenario:** Run the tool successfully in a brownfield project.
      - **Expected Result:**
        - An empty `.env` file is created in the project root.
        - The `.bmad-flattenignore` file is copied from the `template/` directory to the project root.
  5.  **Flattener Path Verification:**
      - **Scenario:** After a successful run, inspect the output file generated by the `bmad-flattener`.
      - **Expected Result:** The file paths contained within the flattened output must be relative to the project root, not the `app/` directory.
  6.  **Post-Installation Notes Review:**
      - **Scenario:** After a successful run.
      - **Expected Result:** The output notes should be manually reviewed to confirm they clearly explain the new override file mechanism and the smart `Makefile` logic.

**Change Log**
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-09-10 | 1.0 | Initial draft | Sarah (PO) |

**Dev Agent Record**
-

**QA Results**
-
