# Story 1.2: Initialize a new Brownfield project

## Status

Done

## Story

**As a** developer,
**I want** to run the CLI and select a "Brownfield" project type,
**so that** I can integrate an existing application into the AI development environment.

## Acceptance Criteria

1.  Running the CLI and selecting "Brownfield" prompts for the path to the existing application.
2.  The `docker-compose.yaml` file is generated with both a `dev` service and an `app` service.
3.  The `app` service in `docker-compose.yaml` correctly mounts the user's provided application path to `/app` in the container.
4.  The `Makefile` is created correctly.
5.  The command `npx bmad-method install` is run successfully.

## Dev Notes

This story extends the CLI to handle the "Brownfield" project type, which involves integrating an existing application.

-   **CLI Logic:** The core logic should be extended to handle the "Brownfield" selection. This will require a new prompt and updated config/generator logic. [Source: `docs/architecture/10-frontend-architecture-cli.md`]
-   **`app` container:** For this brownfield story, the `docker-compose.yaml` must contain both the `dev` service and the `app` service. The `app` service should be configured to mount the user's application path. [Source: `docs/architecture/6-components-revised.md`]
-   **Volume Mount:** The `app` service must include the volume mount: `volumes: - ${APP_PATH:-./app}:/app`. The generator will need to resolve the user's provided path and set it correctly. [Source: `docs/architecture/6-components-revised.md`]

### Testing

-   Unit tests should be created for the new prompt and config logic.
-   An end-to-end test (`tests/e2e/brownfield.bats`) should be created to validate the final output for the brownfield scenario. [Source: `docs/architecture/16-testing-strategy.md`]

## Tasks / Subtasks

-   [x] **Task 1 (AC: 1):** Update the interactive prompts and configuration logic in `src/prompts.ts` and `src/config.ts`.
    -   [x] Subtask 1.1: When the user selects "Brownfield", add a new prompt asking for the path to their existing application.
    -   [x] Subtask 1.2: Update the `Config` type to include the `appPath`.
    -   [x] Subtask 1.3: Write a unit test for the new prompt.

-   [x] **Task 2 (AC: 2, 3):** Update the file generator logic in `src/generator.ts`.
    -   [x] Subtask 2.1: When the `projectType` is `brownfield`, the Docker Compose generator must **include** the `app` service.
    -   [x] Subtask 2.2: The `app` service definition should correctly use the `appPath` from the configuration.
    -   [x] Subtask 2.3: Write a unit test for the generator to ensure the `docker-compose.yaml` is created correctly for the brownfield scenario.

-   [x] **Task 3 (AC: 4, 5):** Write an end-to-end test for the brownfield workflow.
    -   [x] Subtask 3.1: Create a dummy application directory to be used for the test.
    -   [x] Subtask 3.2: Create a new `bats-core` test (`tests/e2e/brownfield.bats`) that runs the CLI, selects "Brownfield", provides the path to the dummy application, and verifies the output.

## Change Log

| Date       | Version | Description   | Author   |
| :--------- | :------ | :------------ | :------- |
| 2025-08-28 | 1.0     | Initial draft | Bob (SM) |
| 2025-09-02 | 1.1     | Completed story, implemented CLI args and fixed e2e tests. | James (Dev) |

## Dev Agent Record

*(This section is to be filled out by the Dev Agent during implementation.)*

### Agent Model Used

Gemini

### Debug Log References

- n/a

### Completion Notes List

- Implemented command-line argument parsing to make the CLI testable.
- Fixed the brownfield e2e test.
- Added a fix for Docker permission errors.

### File List

- `src/index.ts`
- `src/docker.ts`
- `src/prompts.ts`
- `tests/e2e/brownfield.bats`
- `tests/unit/docker.test.ts`
- `package.json`
- `package-lock.json`

## QA Results

*(This section is to be filled out by the QA Agent during review.)*

## QA Results

### Review Date: 2025-09-02

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

The implementation is of high quality. The developer successfully refactored the e2e tests to be more reliable by using command-line arguments, which also improves the overall testability of the CLI. The fix for the Docker permission error is also well-implemented and tested.

### Refactoring Performed

No refactoring was necessary.

### Compliance Check

- Coding Standards: ✓
- Project Structure: ✓
- Testing Strategy: ✓
- All ACs Met: ✓

### Improvements Checklist

- [x] All tasks completed.

### Security Review

No security concerns found.

### Performance Considerations

No performance issues found.

### Files Modified During Review

None.

### Gate Status

Gate: PASS → docs/qa/gates/1.2-initialize-new-brownfield-project.yml

### Recommended Status

✓ Ready for Done